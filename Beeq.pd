#N canvas 960 235 348 175 10;
#N canvas 782 584 409 379 manta_interface 0;
#X obj 133 210 route pad;
#X obj 124 103 manta;
#X obj 124 269 route pad button;
#N canvas 206 411 464 302 handle_buttons 0;
#X obj 107 26 inlet;
#X obj 107 106 select 0 1 2 3;
#X obj 107 53 unpack f f;
#X obj 107 79 spigot;
#X text 158 82 send the button id through on note-on;
#X obj 134 198 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 134 219 s \$0-sequence_type_triplet;
#X obj 127 129 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 127 153 s \$0-step_enable;
#X obj 107 177 t b b;
#X obj 107 242 s \$0-refresh_step_leds;
#X connect 0 0 2 0;
#X connect 1 0 9 0;
#X connect 1 1 7 0;
#X connect 2 0 3 0;
#X connect 2 1 3 1;
#X connect 3 0 1 0;
#X connect 5 0 6 0;
#X connect 7 0 8 0;
#X connect 9 0 10 0;
#X connect 9 1 5 0;
#X restore 170 291 pd handle_buttons;
#N canvas 0 0 450 300 manta_init 0;
#X obj 134 100 outlet;
#X msg 134 72 ledcontrol padandbutton 1;
#X obj 134 44 loadbang;
#X msg 324 72 connect;
#X obj 303 38 t b b;
#X obj 301 8 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 3 0 0 0;
#X connect 4 0 1 0;
#X connect 4 1 3 0;
#X connect 5 0 4 0;
#X restore 105 44 pd manta_init;
#N canvas 317 423 688 476 led_control 0;
#X obj 36 425 outlet;
#X obj 101 57 + 1;
#X msg 101 79 button \$1 0;
#N canvas 621 398 448 363 step_led 0;
#X obj 123 57 r \$0-triplet_step;
#X obj 116 35 r \$0-duplet_step;
#X obj 116 111 mux;
#X obj 155 316 outlet;
#X obj 155 275 f 0;
#X obj 131 81 r \$0-sequence_type_triplet;
#X obj 71 255 pack f f;
#X obj 116 207 r \$0-sequence_type_triplet;
#X obj 116 231 + 1;
#X msg 71 276 pad \$2 \$1;
#X text 27 229 select color;
#X text 188 271 reset the previous step's LED;
#X obj 116 158 step2pad \$0;
#X obj 116 133 t f b;
#X obj 116 183 t f f;
#X obj 155 295 resetstepled \$0;
#X connect 0 0 2 1;
#X connect 1 0 2 0;
#X connect 2 0 13 0;
#X connect 4 0 15 0;
#X connect 5 0 2 2;
#X connect 6 0 9 0;
#X connect 7 0 8 0;
#X connect 8 0 6 1;
#X connect 9 0 3 0;
#X connect 12 0 14 0;
#X connect 13 0 12 0;
#X connect 13 1 4 0;
#X connect 14 0 6 0;
#X connect 14 1 4 1;
#X connect 15 0 3 0;
#X restore 106 180 pd step_led;
#X obj 101 36 r \$0-sequence_type_triplet;
#X text 46 14 handle the sequence type indicator LED;
#X text 21 153 light up the correct pad for the current sequence step
;
#X text 31 254 light up a pad as notes are played;
#N canvas 267 250 385 273 note_led 0;
#X obj 107 199 outlet;
#X obj 107 23 r \$0-note;
#X obj 107 52 unpack f f;
#X text 174 49 note \, velocity;
#X obj 164 74 == 0;
#X obj 164 96 select 1 0;
#X obj 107 91 + 16;
#X text -39 88 notes start in 3rd row;
#X msg 107 176 pad \$2 \$1;
#X obj 107 154 pack f f;
#X obj 164 121 f 0;
#X obj 192 121 f 1;
#X connect 1 0 2 0;
#X connect 2 0 6 0;
#X connect 2 1 4 0;
#X connect 4 0 5 0;
#X connect 5 0 10 0;
#X connect 5 1 11 0;
#X connect 6 0 9 0;
#X connect 8 0 0 0;
#X connect 9 0 8 0;
#X connect 10 0 9 1;
#X connect 11 0 9 1;
#X restore 105 275 pd note_led;
#X obj 484 46 r \$0-step_enable;
#X obj 506 68 r \$0-step;
#X obj 506 91 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X msg 506 111 button \$1 1;
#X text 449 22 blink button 1 when running;
#X obj 36 401 r \$0-led_outlet;
#X obj 506 135 s \$0-led_outlet;
#X obj 105 297 s \$0-led_outlet;
#X obj 106 201 s \$0-led_outlet;
#X obj 101 100 s \$0-led_outlet;
#X obj 497 286 s \$0-led_outlet;
#N canvas 794 719 385 231 refresh_step_leds 0;
#X obj 128 190 outlet;
#X obj 116 12 r \$0-refresh_step_leds;
#X obj 128 139 f;
#X msg 116 35 0;
#X obj 106 114 until;
#X obj 116 62 t b f;
#X obj 162 139 + 1;
#X msg 116 84 16;
#X obj 128 164 resetstepled \$0;
#X connect 1 0 3 0;
#X connect 2 0 6 0;
#X connect 2 0 8 0;
#X connect 3 0 5 0;
#X connect 4 0 2 0;
#X connect 5 0 7 0;
#X connect 5 1 2 1;
#X connect 6 0 2 1;
#X connect 7 0 4 0;
#X connect 8 0 0 0;
#X restore 497 264 pd refresh_step_leds;
#X obj 487 215 s \$0-led_outlet;
#N canvas 183 508 345 239 step_update 0;
#X obj 45 38 r \$0-update_step;
#X obj 45 64 unpack f f;
#X obj 45 141 outlet;
#X obj 45 96 step2pad \$0;
#X obj 45 118 resetstepled \$0;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 2 0;
#X restore 487 192 pd step_update;
#X text 405 170 Track step changes and update LED immediately;
#X connect 1 0 2 0;
#X connect 2 0 18 0;
#X connect 3 0 17 0;
#X connect 4 0 1 0;
#X connect 8 0 16 0;
#X connect 9 0 11 0;
#X connect 10 0 11 0;
#X connect 11 0 12 0;
#X connect 12 0 15 0;
#X connect 14 0 0 0;
#X connect 20 0 19 0;
#X connect 22 0 21 0;
#X restore 129 68 pd led_control;
#N canvas 186 127 626 505 handle_pad_velocity 0;
#X obj 117 13 inlet;
#X obj 117 69 moses 16;
#X obj 298 360 s \$0-step_select;
#X obj 298 319 pack f f;
#X obj 343 92 != 0;
#X obj 224 94 r \$0-step_select;
#X obj 224 117 unpack f f;
#X obj 224 144 == 0;
#X obj 140 118 - 16;
#X obj 117 43 unpack f f;
#X obj 140 145 pack f f;
#X obj 179 197 s \$0-note;
#X obj 179 174 spigot 1;
#X obj 185 94 != 0;
#X obj 185 119 * 150;
#X text 235 172 allow notes through if we don't have a step selected
;
#X obj 168 359 doubletap 500;
#X obj 168 382 s \$0-set_seq_length;
#X obj 117 258 pad2step \$0;
#X connect 0 0 9 0;
#X connect 1 0 18 0;
#X connect 1 1 8 0;
#X connect 3 0 2 0;
#X connect 3 0 16 0;
#X connect 4 0 3 1;
#X connect 5 0 6 0;
#X connect 6 1 7 0;
#X connect 7 0 12 1;
#X connect 8 0 10 0;
#X connect 9 0 1 0;
#X connect 9 1 4 0;
#X connect 9 1 13 0;
#X connect 10 0 12 0;
#X connect 12 0 11 0;
#X connect 13 0 14 0;
#X connect 14 0 10 1;
#X connect 16 0 17 0;
#X connect 18 0 3 0;
#X restore 124 314 pd handle_pad_velocity;
#N canvas 265 111 496 338 handle_pad_continuous 0;
#X obj 147 13 inlet;
#X obj 147 39 unpack f f;
#X obj 147 126 - 16;
#X obj 147 226 s \$0-pad_continuous;
#X text 8 126 note pads start at 16;
#X obj 139 80 moses 16;
#X obj 147 149 manta.poly;
#X obj 147 174 pack f f f;
#X obj 147 197 route 0;
#X text 223 167 limit one pad pressed at a time \, for now;
#X connect 0 0 1 0;
#X connect 1 0 5 0;
#X connect 1 1 6 1;
#X connect 2 0 6 0;
#X connect 5 1 2 0;
#X connect 6 0 7 0;
#X connect 6 1 7 1;
#X connect 6 2 7 2;
#X connect 7 0 8 0;
#X connect 8 0 3 0;
#X restore 133 230 pd handle_pad_continuous;
#X obj 151 125 bang;
#X obj 151 147 s \$0-frame_in;
#N canvas 828 426 341 283 handle_slider 0;
#X obj 79 31 inlet;
#X obj 79 57 route 0 1;
#X obj 104 105 / 512;
#X obj 104 128 int;
#X obj 104 152 change;
#X obj 104 81 unpack f f;
#X obj 131 198 s \$0-page_select;
#X obj 104 175 t b f;
#X obj 104 221 s \$0-refresh_step_leds;
#X connect 0 0 1 0;
#X connect 1 1 5 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 7 0;
#X connect 5 0 2 0;
#X connect 7 0 8 0;
#X connect 7 1 6 0;
#X restore 142 180 pd handle_slider;
#X connect 0 0 7 0;
#X connect 1 0 2 0;
#X connect 1 1 0 0;
#X connect 1 2 10 0;
#X connect 1 3 8 0;
#X connect 2 0 6 0;
#X connect 2 1 3 0;
#X connect 4 0 1 0;
#X connect 5 0 1 0;
#X connect 8 0 9 0;
#X restore 33 59 pd manta_interface;
#N canvas 43 484 446 428 step_counter 0;
#X obj 72 188 f 0;
#X obj 103 188 + 1;
#X text 165 42 incoming BPM is for duplet time;
#X obj 123 45 inlet;
#X obj 72 111 metro 100;
#X obj 123 89 /;
#X msg 123 67 10000 \$1;
#X obj 73 387 s \$0-duplet_step;
#X obj 131 356 s \$0-triplet_step;
#X obj 99 156 s \$0-step;
#X obj 72 14 r \$0-step_enable;
#X obj 201 72 r \$0-set_seq_length;
#X obj 216 117 r \$0-sequence_type_triplet;
#X obj 201 186 *;
#X obj 216 139 select 0 1;
#X obj 216 161 f 3;
#X obj 244 161 f 4;
#X obj 72 133 t b b;
#X text 229 185 this sets the sequence length;
#X obj 201 95 + 1;
#X obj 130 234 < 24;
#X obj 103 257 *;
#X obj 103 211 t f f;
#X obj 73 340 int;
#X obj 73 363 change;
#X obj 73 318 / 3;
#X obj 131 312 int;
#X obj 131 335 change;
#X obj 131 290 / 4;
#X connect 0 0 1 0;
#X connect 1 0 22 0;
#X connect 3 0 6 0;
#X connect 4 0 17 0;
#X connect 5 0 4 1;
#X connect 6 0 5 0;
#X connect 10 0 4 0;
#X connect 11 0 19 0;
#X connect 12 0 14 0;
#X connect 13 0 20 1;
#X connect 14 0 15 0;
#X connect 14 1 16 0;
#X connect 15 0 13 1;
#X connect 16 0 13 1;
#X connect 17 0 0 0;
#X connect 17 1 9 0;
#X connect 19 0 13 0;
#X connect 20 0 21 1;
#X connect 21 0 0 1;
#X connect 21 0 25 0;
#X connect 21 0 28 0;
#X connect 22 0 21 0;
#X connect 22 1 20 0;
#X connect 23 0 24 0;
#X connect 24 0 7 0;
#X connect 25 0 23 0;
#X connect 26 0 27 0;
#X connect 27 0 8 0;
#X connect 28 0 26 0;
#X restore 202 72 pd step_counter;
#N canvas 109 77 465 378 sequences 0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array duplet01_note 128 float 2;
#X coords 0 32 128 0 200 140 1;
#X restore 12 28 graph;
#N canvas 0 0 450 300 (subpatch) 0;
#X array duplet01_value 128 float 2;
#X coords 0 256 128 0 200 140 1;
#X restore 13 190 graph;
#N canvas 0 0 450 300 (subpatch) 0;
#X array triplet01_note 96 float 2;
#X coords 0 32 96 0 200 140 1;
#X restore 225 29 graph;
#N canvas 0 0 450 300 (subpatch) 0;
#X array triplet01_value 96 float 2;
#X coords 0 256 96 0 200 140 1;
#X restore 226 192 graph;
#X restore 33 87 pd sequences;
#N canvas 142 474 742 436 sequence_record 0;
#X obj 191 35 r \$0-step_select;
#X obj 191 59 unpack f f;
#X text 261 57 step number \, selected (0 or 1);
#X obj 277 145 r \$0-pad_continuous;
#X obj 146 317 tabwrite;
#X obj 334 317 tabwrite;
#X obj 277 169 spigot;
#X text 137 335 note table;
#X text 322 334 value table;
#X obj 277 193 unpack f f;
#X text 345 194 note number \, value;
#X obj 523 335 s \$0-update_step;
#X obj 523 219 != 0;
#X obj 523 243 change;
#X obj 523 313 pack f f;
#X obj 523 291 swap;
#X msg 635 208 set -1;
#X obj 608 187 t f b;
#X text 490 354 notify when a step is updated;
#X obj 16 244 tableselector \$0;
#X connect 0 0 1 0;
#X connect 1 0 4 1;
#X connect 1 0 5 1;
#X connect 1 0 17 0;
#X connect 1 1 6 1;
#X connect 3 0 6 0;
#X connect 6 0 9 0;
#X connect 9 0 4 0;
#X connect 9 1 5 0;
#X connect 9 1 12 0;
#X connect 12 0 13 0;
#X connect 13 0 15 0;
#X connect 14 0 11 0;
#X connect 15 0 14 0;
#X connect 15 1 14 1;
#X connect 16 0 13 0;
#X connect 17 0 15 1;
#X connect 17 1 16 0;
#X connect 19 0 4 0;
#X connect 19 1 5 0;
#X restore 33 115 pd sequence_record;
#N canvas 263 38 415 425 sequence_play 0;
#X obj 178 28 r \$0-duplet_step;
#X obj 178 227 r \$0-triplet_step;
#X obj 60 80 tabread duplet01_note;
#X obj 205 80 tabread duplet01_value;
#X obj 178 54 t f f;
#X obj 165 178 s \$0-note;
#X obj 178 252 t f f;
#X obj 165 379 s \$0-note;
#X obj 60 280 tabread triplet01_note;
#X obj 205 280 tabread triplet01_value;
#X obj 60 303 int;
#X obj 60 102 int;
#X obj 165 334 makenote 0 100;
#X obj 165 131 makenote 0 100;
#X obj 165 358 pack f f;
#X obj 165 156 pack f f;
#X obj 311 105 inlet;
#X connect 0 0 4 0;
#X connect 1 0 6 0;
#X connect 2 0 11 0;
#X connect 3 0 13 1;
#X connect 4 0 2 0;
#X connect 4 1 3 0;
#X connect 6 0 8 0;
#X connect 6 1 9 0;
#X connect 8 0 10 0;
#X connect 9 0 12 1;
#X connect 10 0 12 0;
#X connect 11 0 13 0;
#X connect 12 0 14 0;
#X connect 12 1 14 1;
#X connect 13 0 15 0;
#X connect 13 1 15 1;
#X connect 14 0 7 0;
#X connect 15 0 5 0;
#X connect 16 0 13 2;
#X connect 16 0 12 2;
#X restore 203 143 pd sequence_play;
#X floatatom 202 48 5 0 0 2 BPM - -;
#N canvas 492 185 307 171 init 0;
#X obj 58 74 s \$0-sequence_type_triplet;
#X obj 58 30 loadbang;
#X obj 58 52 f 0;
#X connect 1 0 2 0;
#X connect 2 0 0 0;
#X restore 33 31 pd init;
#X floatatom 203 115 5 0 0 2 Note_Length - -;
#N canvas 0 0 317 280 note_handler 0;
#X obj 113 87 r \$0-note;
#X obj 113 144 PadMap;
#X obj 56 36 loadbang;
#X msg 56 59 read Wicki-Hayden.map;
#X obj 113 167 + 40;
#X obj 113 112 unpack f f;
#X text 186 111 note \, value;
#X obj 145 199 noteout 1;
#X connect 0 0 5 0;
#X connect 1 0 4 0;
#X connect 2 0 3 0;
#X connect 3 0 1 0;
#X connect 4 0 7 0;
#X connect 5 0 1 0;
#X connect 5 1 7 1;
#X restore 34 144 pd note_handler;
#X connect 5 0 1 0;
#X connect 7 0 4 0;
